<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Sheet Data Table</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" 
        href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" 
        href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #fafafa;
    }
    h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      text-align: left;
      padding: 10px;
    }
    th {
      background-color: #f2f2f2;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    .filters select {
      padding: 6px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    @media screen and (max-width: 768px) {
      .filters {
        flex-direction: column;
      }
      .filters select {
        width: 100%;
      }
      table {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

  <h2>Google Sheet Data Table (A, C, D & F Columns)</h2>

  <!-- Filter Dropdowns -->
  <div class="filters" id="filterContainer"></div>

  <!-- DataTable -->
  <table id="dataTable" class="display responsive nowrap"></table>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSz4ArArOxyYmfKOKm-LEaWZ_rag9GuV9IFbaukiM8AIAeGLYp2NJDKm9mbXuK4P_-g2Ea7HB9Gbmbm/pub?gid=0&single=true&output=csv";

   
    function parseCSV(text) {
      const rows = [];
      let row = [], cell = '';
      let insideQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const char = text[i], next = text[i + 1];
        if (char === '"' && insideQuotes && next === '"') {
          cell += '"'; i++;
        } else if (char === '"') {
          insideQuotes = !insideQuotes;
        } else if (char === ',' && !insideQuotes) {
          row.push(cell); cell = '';
        } else if (char === '\n' && !insideQuotes) {
          row.push(cell); rows.push(row); row = []; cell = '';
        } else {
          cell += char;
        }
      }
      if (cell || row.length) row.push(cell);
      if (row.length) rows.push(row);
      return rows;
    }

    fetch(sheetUrl)
      .then(res => res.text())
      .then(csv => {
        const rows = parseCSV(csv.trim());
        const headers = rows[0];
        const data = rows.slice(1);

        // Columns A, C, D, F
        const selectedIndexes = [0, 2, 3, 5];
        const selectedHeaders = selectedIndexes.map(i => headers[i] || "");
        const filteredData = data.map(row => selectedIndexes.map(i => row[i] || ""));

       
        const thead = "<thead><tr>" + selectedHeaders.map(h => `<th>${h}</th>`).join("") + "</tr></thead>";
        const tbody = "<tbody>" + filteredData.map(r => "<tr>" + r.map(c => `<td>${c}</td>`).join("") + "</tr>").join("") + "</tbody>";

        document.getElementById("dataTable").innerHTML = thead + tbody;

       
        const table = $('#dataTable').DataTable({
          responsive: true,
          pageLength: 10,
          lengthMenu: [5, 10, 25, 50],
          initComplete: function () {
            const api = this.api();
            const filterContainer = document.getElementById('filterContainer');
            filterContainer.innerHTML = '';

            // Create a dropdown filter for each column
            api.columns().every(function (index) {
              const column = this;
              const label = document.createElement('label');
              label.textContent = selectedHeaders[index] + ": ";
              const select = document.createElement('select');
              select.innerHTML = '<option value="">All</option>';
              select.addEventListener('change', function () {
                const val = $.fn.dataTable.util.escapeRegex(this.value);
                column.search(val ? '^' + val + '$' : '', true, false).draw();
              });

              // Add unique values to dropdown
              column.data().unique().sort().each(function (d) {
                if (d && d.trim()) {
                  const option = document.createElement('option');
                  option.value = d;
                  option.textContent = d;
                  select.appendChild(option);
                }
              });

              label.appendChild(select);
              filterContainer.appendChild(label);
            });
          }
        });
      })
      .catch(err => console.error("Error loading sheet data:", err));
  </script>

</body>
</html>
